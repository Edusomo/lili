<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Controle de SalÃ¡rios & Parceiros</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" sizes="512x512" href="favicon.png">
    <link rel="manifest" href="manifest.json">
    <!-- Adicionei a biblioteca jsPDF aqui -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <img src="favicon.png" alt="Logo" style="height:56px; margin-bottom: 8px;" />
        </header>

        <!-- ConteÃºdo das Abas -->
        <div class="sections">
  <div id="funcionarios" class="section active">

    <!-- Resumo por FuncionÃ¡rio -->
    <section class="summary-section">
        <h2>FuncionÃ¡rios</h2>
        <div id="employee-summary" class="employee-grid">
            <!-- Cards de funcionÃ¡rios serÃ£o gerados dinamicamente -->
        </div>
    </section>

    <!-- Controles de ExportaÃ§Ã£o -->
    <section class="export-section">
        <div class="export-controls">
            <!-- Remover botÃ£o Exportar PDF -->
            <button id="export-excel" class="btn btn--secondary">
                ğŸ“Š Planilha
            </button>
        </div>
    </section>

    <!-- Lista de Registros -->
    <section class="records-section">
        <div class="records-header">
            <h2 id="records-title">ğŸ“‹ Todos os Registros</h2>
            <div class="records-info">
                <span id="records-count">0 registros</span>
            </div>
        </div>
        
        <div id="records-list" class="records-list">
            <!-- Registros serÃ£o gerados dinamicamente -->
        </div>
        <!-- BotÃ£o flutuante para adicionar registro -->
        <button id="btn-add-record" class="fab-add-record" title="Adicionar registro">+</button>
        
        <!-- PaginaÃ§Ã£o -->
        <div id="pagination" class="pagination">
            <!-- Controles de paginaÃ§Ã£o serÃ£o gerados dinamicamente -->
        </div>
    </section>
  </div>

  <div id="parceiros" class="section">
    <button id="fab-add-parceiro" title="Adicionar registro de parceiro"
  style="position:fixed;bottom:88px;right:24px;z-index:1000;width:56px;height:56px;border-radius:50%;background:#1976d2;color:#fff;font-size:2.2em;align-items:center;justify-content:center;box-shadow:0 2px 8px #0003;outline:none;border:none;cursor:pointer;transition:background 0.2s;">
  +</button>
    
    <div class="export-controls" style="margin-bottom:16px;">
  <!-- Remover botÃ£o Exportar PDF -->
  <button id="export-parceiros-excel" class="btn btn--secondary">ğŸ“Š Planilha</button>
  <button id="btn-config-parceiros" class="btn btn--secondary">âš™ï¸ ConfiguraÃ§Ã£o de PreÃ§os</button>
</div>

          <!-- ADICIONE AQUI: -->
          <div class="summary-section">
    <h2>Parceiros</h2>
    <div id="parceiro-cards" class="employee-grid" style="margin-bottom:20px;">
      <!-- Cards dos parceiros serÃ£o gerados via JS -->
    </div>
  </div>

  <!-- Blocos dos parceiros -->
  <div class="parceiro-bloco" id="bloco-coco">
  <div class="parceiro-toggle" data-target="coco" style="display:flex;align-items:center;gap:8px;cursor:pointer;">
  <span class="parceiro-seta" id="seta-coco">&#9654;</span>
  <span>Coco</span>
</button>
  <div class="export-dropdown" style="position:relative;">
    <button type="button" class="btn btn--icon btn-export-dropdown" title="Exportar" style="min-width:80px;">â•°â¤</button>
    <div class="export-menu" style="display:none;position:absolute;z-index:10;left:0;top:110%;background:#fff;border:1px solid #ccc;border-radius:6px;box-shadow:0 2px 8px #0001;">
      <!-- Remover botÃ£o PDF -->
      <button type="button" class="btn btn--icon btn-export-excel" data-parceiro="Coco" style="width:100%;text-align:left;">ğŸ“Š Planilha</button>
    </div>
  </div>
</div>
  <div class="parceiro-conteudo" id="conteudo-coco" style="display:none;">
    <!-- Exemplo para Coco -->
              <ul class="parceiro-registros" id="registros-coco"></ul>
            </div>
          </div>
          <div class="parceiro-bloco" id="bloco-pastel">
  <div class="parceiro-toggle" data-target="pastel" style="display:flex;align-items:center;gap:8px;cursor:pointer;">
  <span class="parceiro-seta" id="seta-pastel">&#9654;</span>
  <span>Pastel</span>
<div class="export-dropdown" style="position:relative;">
    <button type="button" class="btn btn--icon btn-export-dropdown" title="Exportar" style="min-width:80px;">â•°â¤</button>
    <div class="export-menu" style="display:none;position:absolute;z-index:10;left:0;top:110%;background:#fff;border:1px solid #ccc;border-radius:6px;box-shadow:0 2px 8px #0001;">
      <!-- Remover botÃ£o PDF -->
      <button type="button" class="btn btn--icon btn-export-excel" data-parceiro="Pastel" style="width:100%;text-align:left;">ğŸ“Š Planilha</button>
    </div>
  </div>
</div>
  <div class="parceiro-conteudo" id="conteudo-pastel" style="display:none;">
    <!-- Exemplo para Coco, faÃ§a igual para Pastel -->
              <ul class="parceiro-registros" id="registros-pastel"></ul>
            </div>
          </div>
          <div class="parceiro-bloco" id="bloco-gelo">
<div class="parceiro-toggle" data-target="gelo" style="display:flex;align-items:center;gap:8px;cursor:pointer;">
  <span class="parceiro-seta" id="seta-gelo">&#9654;</span>
  <span>Gelo</span>
  <div class="export-dropdown" style="position:relative;">
    <button type="button" class="btn btn--icon btn-export-dropdown" title="Exportar" style="min-width:80px;">â•°â¤</button>
    <div class="export-menu" style="display:none;position:absolute;z-index:10;left:0;top:110%;background:#fff;border:1px solid #ccc;border-radius:6px;box-shadow:0 2px 8px #0001;">
      <!-- Remover botÃ£o PDF -->
      <button type="button" class="btn btn--icon btn-export-excel" data-parceiro="Gelo" style="width:100%;text-align:left;">ğŸ“Š Planilha</button>
    </div>
  </div>
</div>
  <div class="parceiro-conteudo" id="conteudo-gelo" style="display:none;">
    <ul class="parceiro-registros" id="registros-gelo"></ul>
  </div>
</div>
        </div>

  <!-- NOVA ABA: Vendas do Dia -->
<div id="vendas" class="section">
  <section class="vendas-dia-section" style="max-width:600px;margin:16px auto 0 auto;">
    <h2>Vendas do Dia</h2>
    <canvas id="grafico-vendas-dia" height="120" style="width:100%;max-width:600px;margin:0 auto 24px auto;display:block;"></canvas>
    <div style="margin:16px 0 24px 0; padding:16px; background:#f8fafb; border-radius:10px; border:1px solid #e0e0e0;">
      <form id="form-venda-dia" style="display:flex;gap:8px;align-items:flex-end;flex-wrap:wrap;">
        <label style="flex:1;min-width:120px;">
          ğŸ“… Data
          <input type="date" name="data" id="venda-dia-data" required class="form-control">
        </label>
        <label style="flex:1;">
          ğŸ’µ (R$)
                  <input type="number" name="valor" id="venda-dia-valor" step="0.01" required class="form-control">
        </label>
        <label style="flex:2;">
          ğŸ“ ObservaÃ§Ã£o
          <input type="text" name="obs" id="venda-dia-obs" maxlength="100" class="form-control" placeholder="Opcional">
        </label>
        <button type="submit" class="btn btn--primary" style="flex:1;">Registrar</button>
      </form>
      <ul id="lista-venda-dia" style="margin-top:12px;list-style:none;padding:0;"></ul>
    </div>
  </section>
</div>

        <!-- NOVO BLOCO DE NOTAS -->
        <div id="bloco" class="section">
    <section class="notas-section" style="max-width:600px;margin:16px auto 0 auto;">
  <h2>Bloco de Notas</h2>
  <div style="display:flex;justify-content:flex-end;gap:8px;margin-bottom:4px;">
    <button id="font-decrease" type="button" class="btn btn--secondary" style="padding:2px 10px;font-size:1.1em;">A-</button>
    <button id="font-increase" type="button" class="btn btn--secondary" style="padding:2px 10px;font-size:1.1em;">A+</button>
  </div>
  <textarea id="bloco-notas" rows="18" style="width:100%;resize:vertical;font-size:1.1em;padding:12px;border-radius:8px;border:1px solid #ccc;"></textarea>
  <div style="margin-top:8px;text-align:right;">
    <span id="notas-status" style="margin-left:12px;color:#888;font-size:0.95em;"></span>
  </div>
</section>
</div>
    </div>

    <!-- Modal de ConfirmaÃ§Ã£o - SEMPRE COMEÃ‡A OCULTO -->
    <div id="confirmation-modal" class="modal hidden">
        <div class="modal__overlay">
            <div class="modal__content">
                <h3 id="modal-title">âš ï¸ ConfirmaÃ§Ã£o</h3>
                <p id="modal-message">Tem certeza que deseja realizar esta aÃ§Ã£o?</p>
                <div class="modal__actions">
                    <button id="modal-cancel" class="btn btn--secondary">âŒ Cancelar</button>
                    <button id="modal-confirm" class="btn btn--primary">âœ… Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de EdiÃ§Ã£o - SEMPRE COMEÃ‡A OCULTO -->
    <div id="edit-modal" class="modal hidden">
        <div class="modal__overlay">
            <div class="modal__content">
                <h3>âœï¸ Editar Registro</h3>
                <form id="edit-form" class="edit-form">
                    <div class="form-group">
                        <label class="form-label" for="edit-employee">ğŸ‘¤ FuncionÃ¡rio</label>
                        <input type="text" id="edit-employee" name="employee" class="form-control" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="edit-date">ğŸ“… Data</label>
                            <input type="date" id="edit-date" name="date" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="edit-amount">ğŸ’µ Valor (R$)</label>
                            <input type="number" id="edit-amount" name="amount" class="form-control" step="0.01" required>
                            <small class="form-text" style="color: var(--color-text-secondary);">
                                Valores negativos sÃ£o permitidos para descontos.
                            </small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="edit-note">ğŸ“ ObservaÃ§Ãµes</label>
                        <textarea id="edit-note" name="note" class="form-control" rows="3" placeholder="DescriÃ§Ã£o do trabalho ou observaÃ§Ãµes."></textarea>
                    </div>
                    
                    <div class="modal__actions">
                        <button type="button" id="edit-cancel" class="btn btn--secondary">âŒ Cancelar</button>
                        <button type="submit" class="btn btn--primary">ğŸ’¾ Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de EdiÃ§Ã£o Parceiro - SEMPRE COMEÃ‡A OCULTO -->
    <div id="edit-modal-parceiro" class="modal hidden">
  <div class="modal__overlay">
    <div class="modal__content">
      <h3>âœï¸ Editar Registro do Parceiro</h3>
      <form id="edit-form-parceiro" class="edit-form">
        <div class="form-group">
          <label class="form-label" for="edit-data-parc">ğŸ“… Data</label>
          <input type="date" id="edit-data-parc" name="data" class="form-control" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="edit-quantidade-parc">Quantidade</label>
          <input type="number" id="edit-quantidade-parc" name="quantidade" class="form-control" min="1" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="edit-preco-parc">PreÃ§o unitÃ¡rio</label>
          <input type="number" id="edit-preco-parc" name="preco" class="form-control" min="0" step="0.01" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="edit-observacao-parc">ObservaÃ§Ã£o</label>
          <input type="text" id="edit-observacao-parc" name="observacao" class="form-control" maxlength="100">
        </div>
        <div class="form-group" id="edit-tipo-gelo-group" style="display:none;">
  <label class="form-label">Tipo de Gelo</label>
  <div style="display:flex;gap:32px;">
    <label><input type="radio" name="edit-tipo-gelo" value="Cubo"> Cubo</label>
    <label><input type="radio" name="edit-tipo-gelo" value="Triturado"> Triturado</label>
  </div>
</div>
        <div class="modal__actions">
          <button type="button" id="edit-cancel-parc" class="btn btn--secondary">âŒ Cancelar</button>
          <button type="submit" class="btn btn--primary">ğŸ’¾ Salvar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal de configuraÃ§Ã£o de preÃ§os -->
<div id="modal-config-parceiros" class="modal hidden">
  <div class="modal__overlay">
    <div class="modal__content">
      <h3>Configurar PreÃ§os dos Parceiros</h3>
      <form id="form-config-parceiros">
        <label>Coco (R$): <input type="number" step="0.01" min="0" id="preco-coco-config"></label>
        <label>Pastel (R$): <input type="number" step="0.01" min="0" id="preco-pastel-config"></label>
        <label>Gelo Cubo (R$): <input type="number" step="0.01" min="0" id="preco-gelo-cubo-config"></label>
        <label>Gelo Triturado (R$): <input type="number" step="0.01" min="0" id="preco-gelo-triturado-config"></label>
        <div class="modal__actions" style="margin-top:12px;">
          <button type="button" id="cancelar-config-parceiros" class="btn btn--secondary">Cancelar</button>
          <button type="submit" class="btn btn--primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>
</div>

    <!-- Modal de adicionar registro -->
<div id="modal-add-record" class="modal hidden">
  <div class="modal__overlay">
    <div class="modal__content">
      <h3>Adicionar Registro</h3>
      <form id="form-add-record" class="edit-form">
        <div class="form-group">
          <label class="form-label" for="add-employee">ğŸ‘¤ FuncionÃ¡rio</label>
          <input type="text" id="add-employee" name="employee" class="form-control" required>
          <div id="employee-suggestions-modal" class="employee-suggestions"></div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="add-date">ğŸ“… Data</label>
            <input type="date" id="add-date" name="date" class="form-control" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="add-amount">ğŸ’µ Valor (R$)</label>
            <input type="number" id="add-amount" name="amount" class="form-control" step="0.01" required>
            <small class="form-text" style="color: var(--color-text-secondary);">
              Valores negativos sÃ£o permitidos para descontos.
            </small>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label" for="add-note">ğŸ“ ObservaÃ§Ãµes</label>
          <textarea id="add-note" name="note" class="form-control" rows="3" placeholder="DescriÃ§Ã£o do trabalho ou observaÃ§Ãµes."></textarea>
        </div>
        <div class="modal__actions">
          <button type="button" id="add-cancel" class="btn btn--secondary">âŒ Cancelar</button>
          <button type="submit" class="btn btn--primary">Adicionar</button>
        </div>
      </form>
    </div>
  </div>
</div>

    <!-- Modal de adicionar registro do parceiro -->
<div id="modal-add-parceiro" class="modal hidden">
  <div class="modal__overlay">
    <div class="modal__content">
      <h3 id="modal-add-parceiro-title">Adicionar Registro</h3>
      <form id="form-add-parceiro" class="edit-form">
        <div class="form-group">
          <label class="form-label" for="add-parceiro-select">Parceiro</label>
          <select id="add-parceiro-select" name="parceiro" class="form-control" required>
            <option value="Coco">Coco</option>
            <option value="Pastel">Pastel</option>
            <option value="Gelo">Gelo</option>
          </select>
        </div>
        <input type="hidden" id="add-parceiro-nome" name="parceiro">
        <div id="add-parceiro-tipo-gelo-group" style="display:none; margin-bottom:12px;">
          <label style="font-weight:600; font-size:1.05em;">ğŸ§Š Tipo de Gelo</label>
          <div style="display:flex;gap:32px;justify-content:center;margin-top:4px;">
            <label style="display:flex;flex-direction:column;align-items:center;font-weight:500;gap:4px;">
              <input type="radio" name="tipo-gelo-modal" value="Cubo">
              Cubo
            </label>
            <label style="display:flex;flex-direction:column;align-items:center;font-weight:500;gap:4px;">
              <input type="radio" name="tipo-gelo-modal" value="Triturado">
              Triturado
            </label>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label" for="add-parceiro-data">ğŸ“… Data</label>
          <input type="date" id="add-parceiro-data" name="data" class="form-control" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="add-parceiro-quantidade">Quantidade</label>
          <input type="number" id="add-parceiro-quantidade" name="quantidade" class="form-control" min="1" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="add-parceiro-preco">PreÃ§o unitÃ¡rio</label>
          <input type="number" id="add-parceiro-preco" name="preco" class="form-control" min="0" step="0.01" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="add-parceiro-observacao">ObservaÃ§Ã£o</label>
          <input type="text" id="add-parceiro-observacao" name="observacao" class="form-control" maxlength="100">
        </div>
        <div class="modal__actions">
          <button type="button" id="add-parceiro-cancel" class="btn btn--secondary">âŒ Cancelar</button>
          <button type="submit" class="btn btn--primary">Adicionar</button>
        </div>
      </form>
    </div>
  </div>
</div>

    <!-- Modal de ediÃ§Ã£o de venda do dia -->
<div id="modal-editar-venda-dia" class="modal hidden">
  <div class="modal__overlay">
    <div class="modal__content">
      <h3>Editar Venda do Dia</h3>
      <form id="form-editar-venda-dia" style="display:flex;gap:8px;align-items:flex-end;flex-wrap:wrap;">
        <label style="flex:1;min-width:120px;">
          ğŸ“… Data
          <input type="date" id="editar-venda-dia-data" required class="form-control">
        </label>
        <label style="flex:1;">
          ğŸ’µ (R$)
          <input type="number" id="editar-venda-dia-valor" min="0" step="0.01" required class="form-control">
        </label>
        <label style="flex:2;">
          ğŸ“ ObservaÃ§Ã£o
          <input type="text" id="editar-venda-dia-obs" maxlength="100" class="form-control" placeholder="Opcional">
        </label>
        <button type="submit" class="btn btn--primary" style="flex:1;">Salvar</button>
        <button type="button" id="cancelar-editar-venda-dia" class="btn btn--secondary" style="flex:1;">Cancelar</button>
      </form>
    </div>
  </div>
</div>

    <script src="app.js"></script>
    <script>
  // Impede zoom com Ctrl + Scroll
  window.addEventListener('wheel', function(e) {
    if (e.ctrlKey) {
      e.preventDefault();
    }
  }, { passive: false });

  // Impede zoom com Ctrl + "+" ou "-"
  window.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && (e.key === '+' || e.key === '-' || e.key === '=')) {
      e.preventDefault();
    }
  });
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  renderParceiroCards();
  renderVendasDia();
  // AlternÃ¢ncia de abas
  document.querySelectorAll('.btn-export-dropdown').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.stopPropagation();
      // Fecha todos os outros menus primeiro
      document.querySelectorAll('.export-menu').forEach(menu => menu.style.display = 'none');
      // Abre o menu relacionado ao botÃ£o clicado
      const menu = btn.nextElementSibling;
      if (menu) {
        menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
      }
    });

    document.getElementById('parceiro-cards').addEventListener('click', function(e) {
    const card = e.target.closest('.parceiro-card');
    if (!card) return;
    const nome = card.querySelector('.parceiro-card__nome').textContent.replace('ğŸ¤ ', '').trim();
    parceiroSelecionado = nome;
    renderParceiroCards();
  });
  });

  document.querySelectorAll('.btn-export-excel').forEach(btn => {
  btn.addEventListener('click', function(e) {
    e.stopPropagation(); // Impede o fechamento do menu antes do download
    const parceiro = btn.getAttribute('data-parceiro');
    let csv = 'Parceiro,Data,Quantidade,PreÃ§o,ObservaÃ§Ã£o,Tipo\n';
    if (parceiro === 'Gelo') {
      registrosParceiros.Gelo.forEach(reg => {
        csv += `Gelo,"${reg.data || ''}",${reg.quantidade || ''},${reg.preco || ''},"${reg.observacao || ''}","${reg.tipo || ''}"\n`;
      });
    } else {
      registrosParceiros[parceiro].forEach(reg => {
        csv += `${parceiro},"${reg.data}",${reg.quantidade},${reg.preco},"${reg.observacao||''}",\n`;
      });
    }
    const blob = new Blob([csv], { type: 'text/csv' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `${parceiro}.csv`;
    a.click();
    // Fecha o menu apÃ³s o clique
    btn.parentElement.style.display = 'none';
  });
});

  // Fecha o menu ao clicar fora
  document.addEventListener('click', function() {
    document.querySelectorAll('.export-menu').forEach(menu => menu.style.display = 'none');
  });

  // BotÃ£o flutuante de adicionar parceiro
document.getElementById('fab-add-parceiro').onclick = function() {
  const form = document.getElementById('form-add-parceiro');
  form.reset();
  const select = document.getElementById('add-parceiro-select');
  select.value = 'Coco';
  document.getElementById('modal-add-parceiro-title').textContent = 'Adicionar Registro';
  document.getElementById('add-parceiro-data').value = new Date().toISOString().slice(0,10);

  // Atualiza campos conforme o parceiro padrÃ£o
  if (select.value === 'Gelo') {
    document.getElementById('add-parceiro-tipo-gelo-group').style.display = '';
    // Marca "Cubo" por padrÃ£o
    const radios = document.querySelectorAll('input[name="tipo-gelo-modal"]');
    radios.forEach(r => r.checked = (r.value === 'Cubo'));
    document.getElementById('add-parceiro-preco').value = precosGelo.Cubo.toFixed(2);
  } else if (select.value === 'Coco') {
    document.getElementById('add-parceiro-tipo-gelo-group').style.display = 'none';
    document.getElementById('add-parceiro-preco').value = precosParceiros.Coco.toFixed(2);
  } else if (select.value === 'Pastel') {
    document.getElementById('add-parceiro-tipo-gelo-group').style.display = 'none';
    document.getElementById('add-parceiro-preco').value = precosParceiros.Pastel.toFixed(2);
  }

  document.getElementById('modal-add-parceiro').classList.remove('hidden');
  document.getElementById('modal-add-parceiro').style.display = 'flex';
};

// BotÃµes "+" dos blocos de parceiros
document.querySelectorAll('.btn-parceiro-add').forEach(btn => {
  btn.onclick = function() {
    document.getElementById('form-add-parceiro').reset();
    // Define o parceiro conforme o botÃ£o clicado
    const parceiro = btn.getAttribute('data-parceiro');
    document.getElementById('add-parceiro-select').value = parceiro;
    document.getElementById('modal-add-parceiro-title').textContent = 'Adicionar Registro';
    document.getElementById('add-parceiro-data').value = new Date().toISOString().slice(0,10);
    // Dispara o evento change para atualizar preÃ§o e campos
    document.getElementById('add-parceiro-select').dispatchEvent(new Event('change'));
    document.getElementById('modal-add-parceiro').classList.remove('hidden');
    document.getElementById('modal-add-parceiro').style.display = 'flex';
  }
});

  // --- BLOCO DE NOTAS ---
  const textarea = document.getElementById('bloco-notas');
  const status = document.getElementById('notas-status');
  // Carrega ao abrir
  if (textarea) {
    textarea.value = localStorage.getItem('blocoNotas') || '';
    status.textContent = '';
    // Salva automaticamente ao digitar
    textarea.addEventListener('input', function() {
      localStorage.setItem('blocoNotas', textarea.value);
      status.textContent = 'Salvo!';
      setTimeout(() => { status.textContent = ''; }, 1000);
    });

    // --- Controle de tamanho da fonte ---
    const fontKey = 'blocoNotasFontSize';
    const minFont = 12, maxFont = 32, step = 2;
    let fontSize = parseInt(localStorage.getItem(fontKey)) || 18;
    textarea.style.fontSize = fontSize + 'px';

    function setFontSize(size) {
      fontSize = Math.max(minFont, Math.min(maxFont, size));
      textarea.style.fontSize = fontSize + 'px';
      localStorage.setItem(fontKey, fontSize);
    }

    document.getElementById('font-increase').onclick = function() {
      setFontSize(fontSize + step);
    };
    document.getElementById('font-decrease').onclick = function() {
      setFontSize(fontSize - step);
    };
  }

  // Dados dos parceiros
  let precoPadraoCoco = 6.00;
  let precoPadraoPastel = 34.00;
  let precoPadraoGeloCubo = 10.00;
  let precoPadraoGeloTriturado = 35.00;

  const savedRegistros = localStorage.getItem('parceiroRegistros');
if (savedRegistros) registrosParceiros = JSON.parse(savedRegistros);

if (!savedRegistros) {
  // Exemplo inicial para novos usuÃ¡rios
  registrosParceiros.Coco.push({
    data: "2025-01-01",
    quantidade: 1,
    preco: 6.00,
    observacao: ""
  });
  registrosParceiros.Pastel.push({
    data: "2025-01-01",
    quantidade: 1,
    preco: 34.00,
    observacao: ""
  });
  registrosParceiros.Gelo.push({
    data: "2025-01-01",
    quantidade: 1,
    preco: 35.00,
    observacao: ""
  });
  localStorage.setItem('parceiroRegistros', JSON.stringify(registrosParceiros));
}

const savedPrecos = localStorage.getItem('parceiroPrecos');
if (savedPrecos) precosParceiros = JSON.parse(savedPrecos);

const savedPrecosGelo = localStorage.getItem('parceiroPrecosGelo');
if (savedPrecosGelo) precosGelo = JSON.parse(savedPrecosGelo);

  // FuncionÃ¡rios (novo cÃ³digo)
  let funcionarios = [];
const savedFuncionarios = localStorage.getItem('funcionarios');
if (savedFuncionarios) funcionarios = JSON.parse(savedFuncionarios);

  // FunÃ§Ã£o para renderizar registros
  function renderRegistros(parceiro) {
  const ul = document.getElementById('registros-' + parceiro.toLowerCase());
  ul.innerHTML = '';

  // Ordena por data decrescente
  const sorted = [...registrosParceiros[parceiro]].map((reg, i) => ({ ...reg, _originalIdx: i }))
    .sort((a, b) => new Date(b.data) - new Date(a.data));

  sorted.forEach(reg => {
    const total = (reg.quantidade * reg.preco).toFixed(2);
    const precoUnit = parseFloat(reg.preco).toFixed(2);
    const quantidade = reg.quantidade;
    const tipo = reg.tipo ? `<div style="font-weight:600;margin-top:4px;">Tipo: <span style="font-weight:bold;">${reg.tipo}</span></div>` : '';
    const obs = reg.observacao ? `<div class="record-item__note">ğŸ“ ${reg.observacao}</div>` : '';
    const dataFormatada = new Date(reg.data).toLocaleDateString('pt-BR');
    const card = document.createElement('div');
    card.className = 'record-item';
    card.innerHTML = `
      <div style="font-size:1.1em;font-weight:500;">
        ${quantidade} x R$ ${precoUnit} = <span style="font-size:1.2em;font-weight:bold;">R$ ${total}</span>
      </div>
      ${tipo}
      <div class="record-item__date">ğŸ“… ${reg.data.split('-').reverse().join('/')}</div>
      ${obs}
      <div class="record-item__actions" style="margin-top:10px;">
        <button class="btn btn--secondary btn-editar" data-parceiro="${parceiro}" data-idx="${reg._originalIdx}">âœï¸ Editar</button>
        <button class="btn btn--outline btn-excluir-parceiro" data-parceiro="${parceiro}" data-idx="${reg._originalIdx}">ğŸ—‘ï¸ Excluir</button>
      </div>
    `;
    ul.appendChild(card);
  });

  // Desabilita o botÃ£o "Pago" se nÃ£o houver registros
  const btnPago = document.querySelector(`.btn-pago-parceiro[data-parceiro="${parceiro}"]`);
  if (btnPago) {
    if (!registrosParceiros[parceiro] || registrosParceiros[parceiro].length === 0) {
      btnPago.setAttribute('disabled', 'disabled');
    } else {
      btnPago.removeAttribute('disabled');
    }
  }

  // Desabilita os botÃµes de exportaÃ§Ã£o individual se nÃ£o houver registros
  const btnExportPdf = document.querySelector(`.btn-export-pdf[data-parceiro="${parceiro}"]`);
  const btnExportExcel = document.querySelector(`.btn-export-excel[data-parceiro="${parceiro}"]`);
  const temRegistros = registrosParceiros[parceiro] && registrosParceiros[parceiro].length > 0;
  if (btnExportPdf) btnExportPdf.disabled = !temRegistros;
  if (btnExportExcel) btnExportExcel.disabled = !temRegistros;

  atualizarTotalParceiros();
}
window.renderRegistros = renderRegistros;

  function renderEmployeeSummary() {
  const summaryDiv = document.getElementById('employee-summary');
  summaryDiv.innerHTML = '';
  funcionarios.forEach(employee => {
    // Filtra registros desse funcionÃ¡rio
    const registros = registrosFuncionarios.filter(r => r.employee === employee);
    // Calcula o total (evita NaN)
    const total = registros.reduce((soma, reg) => soma + (parseFloat(reg.amount) || 0), 0);
    // Monta o card, mesmo que registros.length === 0
    const card = document.createElement('div');
    card.className = 'employee-card';
    card.innerHTML = `
      <div class="employee-name">${employee}</div>
      <div class="employee-total">Total: R$ ${total.toLocaleString('pt-BR', {minimumFractionDigits:2})}</div>
      <button class="btn btn--danger btn-excluir-funcionario" data-funcionario="${employee}">Excluir</button>
    `;
    summaryDiv.appendChild(card);
  });
}

  atualizarTotalParceiros = () => {
  const totalElemCoco = document.getElementById('total-coco');
const totalElemPastel = document.getElementById('total-pastel');
const totalElemGelo = document.getElementById('total-gelo');
let totalCoco = 0, totalPastel = 0, totalGelo = 0;

if (registrosParceiros.Coco) {
  registrosParceiros.Coco.forEach(reg => {
    const quantidade = parseFloat(reg.quantidade) || 0;
    const preco = parseFloat(reg.preco) || 0;
    totalCoco += quantidade * preco;
  });
}
if (registrosParceiros.Pastel) {
  registrosParceiros.Pastel.forEach(reg => {
    const quantidade = parseFloat(reg.quantidade) || 0;
    const preco = parseFloat(reg.preco) || 0;
    totalPastel += quantidade * preco;
  });
}
if (registrosParceiros.Gelo) {
  registrosParceiros.Gelo.forEach(reg => {
    const quantidade = parseFloat(reg.quantidade) || 0;
    const preco = parseFloat(reg.preco) || 0;
    totalGelo += quantidade * preco;
  });
}
if (totalElemCoco) totalElemCoco.textContent = totalCoco.toLocaleString('pt-BR', {minimumFractionDigits:2});
if (totalElemPastel) totalElemPastel.textContent = totalPastel.toLocaleString('pt-BR', {minimumFractionDigits:2});
if (totalElemGelo) totalElemGelo.textContent = totalGelo.toLocaleString('pt-BR', {minimumFractionDigits:2});

// Atualiza tambÃ©m o total ao lado do nome Coco e Pastel
const headerElemCoco = document.getElementById('total-coco-header');
if (headerElemCoco) headerElemCoco.textContent = `(R$ ${totalCoco.toLocaleString('pt-BR', {minimumFractionDigits:2})})`;
const headerElemPastel = document.getElementById('total-pastel-header');
if (headerElemPastel) headerElemPastel.textContent = `(R$ ${totalPastel.toLocaleString('pt-BR', {minimumFractionDigits:2})})`;
const headerElemGelo = document.getElementById('total-gelo-header');
if (headerElemGelo) headerElemGelo.textContent = `(R$ ${totalGelo.toLocaleString('pt-BR', {minimumFractionDigits:2})})`;
};

  // Inicializa registros
  renderRegistros('Coco');
  renderRegistros('Pastel');
  renderRegistros('Gelo');

  // ExclusÃ£o de registros
  let excluirParceiroInfo = null;
  let pagarParceiroInfo = null;
  let idxParaExcluir = null;

  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('btn-excluir-parceiro')) {
      e.preventDefault();
      excluirParceiroInfo = {
        parceiro: e.target.dataset.parceiro,
        idx: parseInt(e.target.dataset.idx, 10)
      };
      document.getElementById('modal-title').textContent = 'âš ï¸ ConfirmaÃ§Ã£o';
      document.getElementById('modal-message').textContent = 'Tem certeza que deseja excluir este registro?';
      document.getElementById('confirmation-modal').classList.remove('hidden');
      document.getElementById('confirmation-modal').style.display = 'block';
    } else if (e.target.classList.contains('btn-pago-parceiro')) {
      e.preventDefault();
      const parceiro = e.target.dataset.parceiro;
      pagarParceiroInfo = parceiro;
      document.getElementById('modal-title').textContent = 'âš ï¸ ConfirmaÃ§Ã£o';
      document.getElementById('modal-message').textContent = `Tem certeza que deseja marcar tudo como pago? Isso irÃ¡ limpar todos os registros de ${parceiro}.`;
      document.getElementById('confirmation-modal').classList.remove('hidden');
      document.getElementById('confirmation-modal').style.display = 'block';
    } else if (e.target.classList.contains('btn-excluir-venda-dia')) {
      idxParaExcluir = parseInt(e.target.dataset.idx, 10);
      document.getElementById('modal-excluir-venda-dia').classList.remove('hidden');
      document.getElementById('modal-excluir-venda-dia').style.display = 'block';
    }
  });

  // Confirma aÃ§Ã£o de "Pago" OU exclusÃ£o
  document.getElementById('modal-confirm').onclick = function() {
    if (excluirParceiroInfo) {
      registrosParceiros[excluirParceiroInfo.parceiro].splice(excluirParceiroInfo.idx, 1);
      salvarParceiros();
      renderRegistros(excluirParceiroInfo.parceiro);
      excluirParceiroInfo = null;
      // Adicione:
      if (window.salaryTracker) window.salaryTracker.showFeedback('ğŸ—‘ï¸ Registro excluÃ­do com sucesso!', 'success');
    } else if (pagarParceiroInfo) {
      registrosParceiros[pagarParceiroInfo] = [];
      salvarParceiros();
      renderRegistros(pagarParceiroInfo);
      atualizarTotalParceiros();
      // Adicione esta linha:
      if (window.salaryTracker) window.salaryTracker.showFeedback('ğŸ’° Registros marcados como pagos!', 'success');
      pagarParceiroInfo = null;
    }

    // --- NOVO: Apagar registros do parceiro ao confirmar "Pago" pelo card ---
    if (window._parceiroPagoKey) {
      window.registrosParceiros[window._parceiroPagoKey] = [];
      localStorage.setItem('parceiroRegistros', JSON.stringify(window.registrosParceiros));
      renderParceiroCards();
      // Atualize tambÃ©m os blocos de registros, se necessÃ¡rio:
      if (typeof renderRegistros === 'function') renderRegistros(window._parceiroPagoKey);
      if (window.salaryTracker) window.salaryTracker.showFeedback('ğŸ’° Registros marcados como pagos!', 'success');
      window._parceiroPagoKey = null;
    }

    document.getElementById('confirmation-modal').classList.add('hidden');
    document.getElementById('confirmation-modal').style.display = 'none';
  };
  // Cancela aÃ§Ã£o
  document.getElementById('modal-cancel').onclick = function() {
    excluirParceiroInfo = null;
    pagarParceiroInfo = null;
    document.getElementById('confirmation-modal').classList.add('hidden');
    document.getElementById('confirmation-modal').style.display = 'none';
  };

  // EdiÃ§Ã£o de registros
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('btn-editar')) {
    e.preventDefault();
    const idx = e.target.dataset.idx;
    const parceiro = e.target.dataset.parceiro;
    const registro = registrosParceiros[parceiro][idx];
    editParceiroInfo = { parceiro, idx };

    // Esconde o modal antigo de funcionÃ¡rios, se estiver aberto
    document.getElementById('edit-modal').classList.add('hidden');
    document.getElementById('edit-modal').style.display = 'none';

    // Preenche os campos do modal novo
    document.getElementById('edit-data-parc').value = registro.data;
    document.getElementById('edit-quantidade-parc').value = registro.quantidade;
    document.getElementById('edit-preco-parc').value = registro.preco;
    document.getElementById('edit-observacao-parc').value = registro.observacao || '';

    // Tipo de gelo: sÃ³ mostra se for Gelo
    const tipoGeloGroup = document.getElementById('edit-tipo-gelo-group');
    if (parceiro === 'Gelo') {
      tipoGeloGroup.style.display = '';
      // Marca o radio correspondente
      if (registro.tipo) {
        const radios = tipoGeloGroup.querySelectorAll('input[name="edit-tipo-gelo"]');
        radios.forEach(radio => {
          radio.checked = (radio.value === registro.tipo);
        });
      }
    } else {
      tipoGeloGroup.style.display = 'none';
    }

    document.getElementById('edit-modal-parceiro').classList.remove('hidden');
    document.getElementById('edit-modal-parceiro').style.display = 'block';
  }
  });

  // Salvar parceiros (exemplo simplificado, deve ser adaptado para sua lÃ³gica)
  window.salvarParceiros = function salvarParceiros() {
    localStorage.setItem('parceiroRegistros', JSON.stringify(registrosParceiros));
    localStorage.setItem('parceiroPrecos', JSON.stringify(precosParceiros));
    localStorage.setItem('parceiroPrecosGelo', JSON.stringify(precosGelo));
}

  // ExpansÃ£o/colapso dos blocos de parceiros
  document.querySelectorAll('.parceiro-toggle').forEach(btn => {
    btn.addEventListener('click', function(e) {
      // SÃ³ expande/recolhe se nÃ£o clicar no botÃ£o "Pago"
      if (e.target.classList.contains('btn-pago-parceiro')) return;
      // ADICIONE ESTA LINHA:
      if (e.target.closest('.export-dropdown')) return;
      const target = this.dataset.target;
      const conteudo = document.getElementById('conteudo-' + target);
      const seta = document.getElementById('seta-' + target);
      if (conteudo.style.display === 'none' || conteudo.style.display === '') {
        conteudo.style.display = 'block';
        seta.style.transform = 'rotate(90deg)';
      } else {
        conteudo.style.display = 'none';
        seta.style.transform = 'rotate(0deg)';
      }
    });
  });

  // Inicializa ambos abertos por padrÃ£o
  ['coco', 'pastel', 'gelo'].forEach(parc => {
  if (parc === 'coco') {
    document.getElementById('conteudo-coco').style.display = 'block';
    document.getElementById('seta-coco').style.transform = 'rotate(90deg)';
  } else {
    document.getElementById('conteudo-' + parc).style.display = 'none';
    document.getElementById('seta-' + parc).style.transform = 'rotate(0deg)';
  }
});

  document.querySelectorAll('.parceiro-form').forEach(form => {
  const parceiro = form.dataset.parceiro;
  if (parceiro === 'Gelo') {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const tipo = form.querySelector('input[name="tipo-gelo"]:checked');
      const data = form.data.value;
      const quantidade = parseFloat(form.quantidade.value);
      const preco = parseFloat(form.preco.value);
      const observacao = form.observacao.value || '';
      if (!tipo) return;
      registrosParceiros.Gelo.push({
        tipo: tipo.value,
        data,
        quantidade,
        preco,
        observacao
      });
      salvarParceiros();
      renderRegistros('Gelo');
      renderParceiroCards()
      form.reset();
      // Define a data de hoje novamente apÃ³s reset
      const hoje = new Date();
      form.data.value = hoje.toISOString().slice(0,10);
    });
  } else {
    form.preco.value = precosParceiros[parceiro].toFixed(2);
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const data = form.data.value;
      const quantidade = parseFloat(form.quantidade.value);
      const preco = parseFloat(form.preco.value);
      const observacao = form.observacao.value || '';
      registrosParceiros[parceiro].push({ data, quantidade, preco, observacao });
      salvarParceiros();
      renderRegistros(parceiro);
      renderParceiroCards();
      form.reset();
      form.preco.value = precosParceiros[parceiro].toFixed(2); // Sempre repÃµe o padrÃ£o
if (window.salaryTracker) window.salaryTracker.showFeedback('âœ… Registro adicionado com sucesso!', 'success');
    });
  }
});

  // Exportar Planilha (Excel)
  document.getElementById('export-parceiros-excel').onclick = function() {
  let csv = 'Parceiro,Data,Quantidade,PreÃ§o,ObservaÃ§Ã£o,Tipo\n';
  ['Coco','Pastel','Gelo'].forEach(parc => {
    if (parc === 'Gelo') {
      registrosParceiros.Gelo.forEach(reg => {
        csv += `Gelo,"${reg.data || ''}",${reg.quantidade || ''},${reg.preco || ''},"${reg.observacao || ''}","${reg.tipo || ''}"\n`;
      });
    } else {
      registrosParceiros[parc].forEach(reg => {
        csv += `${parc},"${reg.data}",${reg.quantidade},${reg.preco},"${reg.observacao||''}",\n`;
      });
    }
  });
  const blob = new Blob([csv], { type: 'text/csv' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'parceiros.csv';
  a.click();
};

// EdiÃ§Ã£o de registros de parceiros
let editParceiroInfo = null;

document.addEventListener('click', function(e) {
  if (e.target.classList.contains('btn-editar')) {
    e.preventDefault();
    const idx = e.target.dataset.idx;
    const parceiro = e.target.dataset.parceiro;
    const registro = registrosParceiros[parceiro][idx];
    editParceiroInfo = { parceiro, idx };

    // Esconde o modal antigo de funcionÃ¡rios, se estiver aberto
    document.getElementById('edit-modal').classList.add('hidden');
    document.getElementById('edit-modal').style.display = 'none';

    // Preenche os campos do modal novo
    document.getElementById('edit-data-parc').value = registro.data;
    document.getElementById('edit-quantidade-parc').value = registro.quantidade;
    document.getElementById('edit-preco-parc').value = registro.preco;
    document.getElementById('edit-observacao-parc').value = registro.observacao || '';

    document.getElementById('edit-modal-parceiro').classList.remove('hidden');
    document.getElementById('edit-modal-parceiro').style.display = 'block';
  }
});

// Fechar modal de ediÃ§Ã£o do parceiro ao clicar fora
document.querySelector('#edit-modal-parceiro .modal__overlay').onclick = function(e) {
  if (e.target === this) {
    editParceiroInfo = null;
    document.getElementById('edit-modal-parceiro').classList.add('hidden');
    document.getElementById('edit-modal-parceiro').style.display = 'none';
  }
};

// Cancelar ediÃ§Ã£o
document.getElementById('edit-cancel-parc').onclick = function() {
  editParceiroInfo = null;
  document.getElementById('edit-modal-parceiro').classList.add('hidden');
  document.getElementById('edit-modal-parceiro').style.display = 'none';
};

// Salvar ediÃ§Ã£o
document.getElementById('edit-form-parceiro').onsubmit = function(ev) {
    ev.preventDefault();
    if (!editParceiroInfo) return;
    const { parceiro, idx } = editParceiroInfo;
    const registro = registrosParceiros[parceiro][idx];
    registro.data = document.getElementById('edit-data-parc').value;
    registro.quantidade = parseFloat(document.getElementById('edit-quantidade-parc').value);
    registro.preco = parseFloat(document.getElementById('edit-preco-parc').value);
    registro.observacao = document.getElementById('edit-observacao-parc').value;
    // Atualize o tipo de gelo ANTES de salvar e renderizar
    if (parceiro === 'Gelo') {
      const tipoRadio = document.querySelector('input[name="edit-tipo-gelo"]:checked');
      registro.tipo = tipoRadio ? tipoRadio.value : '';
    }
    salvarParceiros();
    renderRegistros(parceiro);
    renderParceiroCards();
    document.getElementById('edit-modal-parceiro').classList.add('hidden');
    document.getElementById('edit-modal-parceiro').style.display = 'none';
    editParceiroInfo = null;
    if (window.salaryTracker) window.salaryTracker.showFeedback('âœï¸ Registro editado com sucesso!', 'success');
};

// Abrir modal de configuraÃ§Ã£o
document.getElementById('btn-config-parceiros').onclick = function() {
  document.getElementById('preco-coco-config').value = precosParceiros.Coco.toFixed(2);
  document.getElementById('preco-pastel-config').value = precosParceiros.Pastel.toFixed(2);
  document.getElementById('preco-gelo-cubo-config').value = precosGelo.Cubo.toFixed(2);
  document.getElementById('preco-gelo-triturado-config').value = precosGelo.Triturado.toFixed(2);
  document.getElementById('modal-config-parceiros').classList.remove('hidden');
  document.getElementById('modal-config-parceiros').style.display = 'block';
};
// Fechar modal de configuraÃ§Ã£o
document.getElementById('cancelar-config-parceiros').onclick = function() {
  document.getElementById('modal-config-parceiros').classList.add('hidden');
  document.getElementById('modal-config-parceiros').style.display = 'none';
};
// Salvar novos preÃ§os
document.getElementById('form-config-parceiros').onsubmit = function(e) {
  e.preventDefault();
  precosParceiros.Coco = parseFloat(document.getElementById('preco-coco-config').value);
  precosParceiros.Pastel = parseFloat(document.getElementById('preco-pastel-config').value);
  precosGelo.Cubo = parseFloat(document.getElementById('preco-gelo-cubo-config').value);
  precosGelo.Triturado = parseFloat(document.getElementById('preco-gelo-triturado-config').value);
  salvarParceiros();
  // Atualiza os formulÃ¡rios de registro
  document.querySelector('form[data-parceiro="Coco"] input[name="preco"]').value = precosParceiros.Coco.toFixed(2);
  document.querySelector('form[data-parceiro="Pastel"] input[name="preco"]').value = precosParceiros.Pastel.toFixed(2);
  // Atualiza preÃ§o do Gelo conforme tipo selecionado
  const geloForm = document.querySelector('form[data-parceiro="Gelo"]');
  if (geloForm) {
    const checked = geloForm.querySelector('input[name="tipo-gelo"]:checked');
    const precoInput = geloForm.querySelector('input[name="preco"]');
    if (checked && precoInput) precoInput.value = precosGelo[checked.value].toFixed(2);
  }
  document.getElementById('modal-config-parceiros').classList.add('hidden');
  document.getElementById('modal-config-parceiros').style.display = 'none';
  // Adicione:
  if (window.salaryTracker) window.salaryTracker.showFeedback('ğŸ’¾ PreÃ§os atualizados com sucesso!', 'success');
};

// Define a data de hoje nos inputs de data ao carregar a pÃ¡gina
document.querySelectorAll('.parceiro-form input[type="date"]').forEach(input => {
  const hoje = new Date();
  input.value = hoje.toISOString().slice(0,10);
});

// Atualiza o preÃ§o no input ao mudar o tipo de gelo
document.querySelectorAll('form[data-parceiro="Gelo"] input[name="tipo-gelo"]').forEach(radio => {
  radio.addEventListener('change', function() {
    const precoInput = this.closest('form').querySelector('input[name="preco"]');
    precoInput.value = precosGelo[this.value].toFixed(2);
  });
});
// Ao carregar a pÃ¡gina, defina o preÃ§o padrÃ£o conforme o tipo selecionado
const geloForm = document.querySelector('form[data-parceiro="Gelo"]');
if (geloForm) {
  const checked = geloForm.querySelector('input[name="tipo-gelo"]:checked');
  const precoInput = geloForm.querySelector('input[name="preco"]');
  if (checked && precoInput) precoInput.value = precosGelo[checked.value].toFixed(2);
}
});
</script>

<!-- Modal de confirmaÃ§Ã£o de exclusÃ£o de venda do dia -->
<div id="modal-excluir-venda-dia" class="modal hidden">
  <div class="modal__overlay">
    <div class="modal__content">
      <h3>Excluir venda?</h3>
      <p>Tem certeza que deseja excluir este registro?</p>
      <div class="modal__actions">
        <button id="cancelar-excluir-venda-dia" class="btn btn--secondary">Cancelar</button>
        <button id="confirmar-excluir-venda-dia" class="btn btn--primary">Excluir</button>
      </div>
    </div>
  </div>
</div>

<!-- Barra de navegaÃ§Ã£o inferior -->
<div class="bottom-tab-bar">
  <div class="tab active" data-section="funcionarios">
    <span class="icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users-icon lucide-users"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><path d="M16 3.128a4 4 0 0 1 0 7.744"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><circle cx="9" cy="7" r="4"/></svg>
    </span>
    <span class="label">FuncionÃ¡rios</span>
  </div>
  <div class="tab" data-section="parceiros">
    <span class="icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-handshake-icon lucide-handshake"><path d="m11 17 2 2a1 1 0 1 0 3-3"/><path d="m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4"/><path d="m21 3 1 11h-2"/><path d="M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3"/><path d="M3 4h8"/></svg>  
    </span>
    <span class="label">Parceiros</span>
  </div>
  <!-- NOVA ABA -->
  <div class="tab" data-section="vendas">
    <span class="icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cash"><rect x="2" y="6" width="20" height="12" rx="2"/><path d="M18 12h.01"/><path d="M6 12h.01"/><path d="M12 12h.01"/></svg>
    </span>
    <span class="label">Vendas</span>
  </div>
  <div class="tab" data-section="bloco">
    <span class="icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard-list-icon lucide-clipboard-list"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>  
    </span>
    <span class="label">Bloco de Notas</span>  
  </div>
</div>

<script>
const tabs = document.querySelectorAll('.bottom-tab-bar .tab');
const sections = document.querySelectorAll('.sections .section');

tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    sections.forEach(sec => sec.classList.remove('active'));
    const sectionId = tab.getAttribute('data-section');
    document.getElementById(sectionId).classList.add('active');
  });
});

// --- VENDAS DO DIA ABA ---
let vendasDia = JSON.parse(localStorage.getItem('vendasDia') || '[]');
let editVendaIdx = null;

function renderVendasDia() {
  const ul = document.getElementById('lista-venda-dia');
  if (!ul) return;
  ul.innerHTML = '';
  // Ordena por data decrescente
  const sorted = [...vendasDia].sort((a, b) => new Date(b.data) - new Date(a.data));
  sorted.forEach((venda) => {
  const realIdx = vendasDia.findIndex(v =>
    v.data === venda.data &&
    Number(v.valor) === Number(venda.valor) &&
    (v.obs || '') === (venda.obs || '')
  );
  const obs = venda.obs ? ` <span style="color:#888;">(${venda.obs})</span>` : '';
  ul.innerHTML += `
  <li style="margin-bottom:16px;">
    <div>
      <strong>${venda.data.split('-').reverse().join('/')}</strong>: 
      <span style="font-weight:600;color:#21808d;">R$ ${parseFloat(venda.valor).toLocaleString('pt-BR', {minimumFractionDigits:2})}</span>
      ${obs}
    </div>
    <div style="margin-top:6px; display:flex; gap:8px;">
      <button class="btn btn--outline btn-editar-venda-dia" data-idx="${realIdx}" style="padding:2px 10px;">âœï¸</button>
      <button class="btn btn--outline btn-excluir-venda-dia" data-idx="${realIdx}" style="padding:2px 10px;">ğŸ—‘ï¸</button>
    </div>
  </li>
`;
});
  renderGraficoVendasDia();
}

document.getElementById('form-venda-dia').onsubmit = function(e) {
  e.preventDefault();
  const data = document.getElementById('venda-dia-data').value;
  const valor = parseFloat(document.getElementById('venda-dia-valor').value);
  const obs = document.getElementById('venda-dia-obs').value;
  if (!data || isNaN(valor)) return;
  if (editVendaIdx !== null) {
    vendasDia[editVendaIdx] = { data, valor, obs };
    editVendaIdx = null;
    this.querySelector('button[type="submit"]').textContent = 'Registrar';
  } else {
    vendasDia.push({ data, valor, obs });
  }
  localStorage.setItem('vendasDia', JSON.stringify(vendasDia));
  renderVendasDia();
  this.reset();
  document.getElementById('venda-dia-data').value = new Date().toISOString().slice(0,10);
  if (window.salaryTracker) window.salaryTracker.showFeedback('âœ… Venda registrada!', 'success');
};

document.addEventListener('click', function(e) {
  if (e.target.classList.contains('btn-excluir-venda-dia')) {
    idxParaExcluir = parseInt(e.target.dataset.idx, 10);
    document.getElementById('modal-excluir-venda-dia').classList.remove('hidden');
    document.getElementById('modal-excluir-venda-dia').style.display = 'block';
  }
  if (e.target.classList.contains('btn-editar-venda-dia')) {
    const idx = parseInt(e.target.dataset.idx, 10);
    const venda = vendasDia[idx];
    document.getElementById('editar-venda-dia-data').value = venda.data;
    document.getElementById('editar-venda-dia-valor').value = venda.valor;
    document.getElementById('editar-venda-dia-obs').value = venda.obs || '';
    editVendaIdx = idx;
    document.querySelector('#form-venda-dia button[type="submit"]').textContent = 'Salvar';
    window.scrollTo({ top: document.getElementById('form-venda-dia').offsetTop - 40, behavior: 'smooth' });
  }
});

// Data de hoje por padrÃ£o
document.getElementById('venda-dia-data').value = new Date().toISOString().slice(0,10);

function renderGraficoVendasDia() {
  const canvas = document.getElementById('grafico-vendas-dia');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  // Agrupa por mÃªs
  const porMes = {};
  vendasDia.forEach(v => {
    if (!v.data) return;
    const [ano, mes] = v.data.split('-');
    const chave = `${ano}-${mes}`;
    porMes[chave] = (porMes[chave] || 0) + Number(v.valor || 0);
  });
  const meses = Object.keys(porMes).sort(); // ordem crescente
  const labels = meses.map(m => {
    const [ano, mes] = m.split('-');
    return `${mes}/${ano}`;
  });
  const data = meses.map(m => porMes[m]);

  // Destroi grÃ¡fico anterior se existir
  if (window._graficoVendasDia) window._graficoVendasDia.destroy();
  window._graficoVendasDia = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Vendas mensais (R$)',
        data: data,
        backgroundColor: data.map(v => v < 0 ? '#e53935' : '#21808d')
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        title: { display: false }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            callback: value => 'R$ ' + value.toLocaleString('pt-BR', {minimumFractionDigits:2})
          }
        }
      }
    }
  });
}

renderVendasDia();
let vendasDiaBloco = JSON.parse(localStorage.getItem('vendasDiaBloco') || '[]');

function renderVendasDiaBloco() {
  const ul = document.getElementById('lista-venda-dia-bloco');
  if (!ul) return;
  ul.innerHTML = '';
  // Ordena por data decrescente
  const sorted = [...vendasDiaBloco].sort((a, b) => new Date(b.data) - new Date(a.data));
  sorted.forEach((venda) => {
  const realIdx = vendasDia.findIndex(v =>
    v.data === venda.data &&
    Number(v.valor) === Number(venda.valor) &&
    (v.obs || '') === (venda.obs || '')
  );
  const obs = venda.obs ? ` <span style="color:#888;">(${venda.obs})</span>` : '';
  ul.innerHTML += `
    <li style="margin-bottom:8px;">
      <strong>${venda.data.split('-').reverse().join('/')}</strong>: 
      <span style="font-weight:600;color:#21808d;">R$ ${parseFloat(venda.valor).toLocaleString('pt-BR', {minimumFractionDigits:2})}</span>
      ${obs}
      <button class="btn btn--outline btn-editar-venda-dia" data-idx="${realIdx}" style="margin-left:8px;padding:2px 10px;">âœï¸</button>
      <button class="btn btn--outline btn-excluir-venda-dia" data-idx="${realIdx}" style="margin-left:4px;padding:2px 10px;">ğŸ—‘ï¸</button>
    </li>
  `;
});
}

const formVendaBloco = document.getElementById('form-venda-dia-bloco');
if (formVendaBloco) {
  formVendaBloco.onsubmit = function(e) {
    e.preventDefault();
    const data = document.getElementById('venda-dia-data-bloco').value;
    const valor = parseFloat(document.getElementById('venda-dia-valor-bloco').value);
    if (!data || isNaN(valor)) return;
    vendasDiaBloco.push({ data, valor });
    localStorage.setItem('vendasDiaBloco', JSON.stringify(vendasDiaBloco));
    renderVendasDiaBloco();
    this.reset();
    document.getElementById('venda-dia-data-bloco').value = new Date().toISOString().slice(0,10);
    if (window.salaryTracker) window.salaryTracker.showFeedback('âœ… Venda registrada!', 'success');
  };
}

document.addEventListener('click', function(e) {
  if (e.target.classList.contains('btn-excluir-venda-dia-bloco')) {
    const idx = parseInt(e.target.dataset.idx, 10);
    vendasDiaBloco.splice(idx, 1);
    localStorage.setItem('vendasDiaBloco', JSON.stringify(vendasDiaBloco));
    renderVendasDiaBloco();
    if (window.salaryTracker) window.salaryTracker.showFeedback('ğŸ—‘ï¸ Venda removida!', 'success');
  }
});

// Data de hoje por padrÃ£o
const inputDataBloco = document.getElementById('venda-dia-data-bloco');
if (inputDataBloco) inputDataBloco.value = new Date().toISOString().slice(0,10);

renderVendasDiaBloco();

document.getElementById('cancelar-excluir-venda-dia').onclick = function() {
  idxParaExcluir = null;
  document.getElementById('modal-excluir-venda-dia').classList.add('hidden');
 

  document.getElementById('modal-excluir-venda-dia').style.display = 'none';
};

document.getElementById('confirmar-excluir-venda-dia').onclick = function() {
  if (idxParaExcluir !== null) {
    vendasDia.splice(idxParaExcluir, 1);
    localStorage.setItem('vendasDia', JSON.stringify(vendasDia));
    renderVendasDia();
    if (window.salaryTracker) window.salaryTracker.showFeedback('ğŸ—‘ï¸ Venda removida!', 'success');
  }
  idxParaExcluir = null;
  document.getElementById('modal-excluir-venda-dia').classList.add('hidden');
  document.getElementById('modal-excluir-venda-dia').style.display = 'none';
};

let editVendaDiaIdx = null;

// Abrir modal ao clicar em editar
document.addEventListener('click', function(e) {
  if (e.target.classList.contains('btn-editar-venda-dia')) {
    const idx = parseInt(e.target.dataset.idx, 10);
    const venda = vendasDia[idx];
    if (!venda) return;
    editVendaDiaIdx = idx;
    document.getElementById('editar-venda-dia-data').value = venda.data;
    document.getElementById('editar-venda-dia-valor').value = venda.valor;
    document.getElementById('editar-venda-dia-obs').value = venda.obs || '';
    document.getElementById('modal-editar-venda-dia').classList.remove('hidden');
    document.getElementById('modal-editar-venda-dia').style.display = 'flex';
  }
});

// Cancelar ediÃ§Ã£o
document.getElementById('cancelar-editar-venda-dia').onclick = function() {
  editVendaDiaIdx = null;
  document.getElementById('modal-editar-venda-dia').classList.add('hidden');
  document.getElementById('modal-editar-venda-dia').style.display = 'none';
};

// Salvar ediÃ§Ã£o
document.getElementById('form-editar-venda-dia').onsubmit = function(e) {
  e.preventDefault();
  if (editVendaDiaIdx === null) return;
  const data = document.getElementById('editar-venda-dia-data').value;
  const valor = parseFloat(document.getElementById('editar-venda-dia-valor').value);
  const obs = document.getElementById('editar-venda-dia-obs').value;
  vendasDia[editVendaDiaIdx] = { data, valor, obs };
  localStorage.setItem('vendasDia', JSON.stringify(vendasDia));
  renderVendasDia();
  editVendaDiaIdx = null;
  document.getElementById('modal-editar-venda-dia').classList.add('hidden');
  document.getElementById('modal-editar-venda-dia').style.display = 'none';
  if (window.salaryTracker) window.salaryTracker.showFeedback('âœï¸ Venda editada com sucesso!', 'success');
};

// Mostra/esconde tipo de gelo conforme seleÃ§Ã£o
document.getElementById('add-parceiro-select').onchange = function() {
  const parceiro = this.value;
  if (parceiro === 'Gelo') {
    document.getElementById('add-parceiro-tipo-gelo-group').style.display = '';
    // Marca "Cubo" por padrÃ£o
    const radios = document.querySelectorAll('input[name="tipo-gelo-modal"]');
    radios.forEach(r => r.checked = (r.value === 'Cubo'));
    document.getElementById('add-parceiro-preco').value = precosGelo.Cubo.toFixed(2);
  } else if (parceiro === 'Coco') {
    document.getElementById('add-parceiro-tipo-gelo-group').style.display = 'none';
    document.getElementById('add-parceiro-preco').value = precosParceiros.Coco.toFixed(2);
  } else if (parceiro === 'Pastel') {
    document.getElementById('add-parceiro-tipo-gelo-group').style.display = 'none';
    document.getElementById('add-parceiro-preco').value = precosParceiros.Pastel.toFixed(2);
  }
};

document.querySelectorAll('input[name="tipo-gelo-modal"]').forEach(radio => {
  radio.addEventListener('change', function() {
    document.getElementById('add-parceiro-preco').value = precosGelo[this.value].toFixed(2);
  });
});

// Fechar modal ao cancelar no modal de adicionar parceiro
document.getElementById('add-parceiro-cancel').onclick = function() {
  document.getElementById('modal-add-parceiro').classList.add('hidden');
  document.getElementById('modal-add-parceiro').style.display = 'none';
};

// Salvar novo registro de parceiro
document.getElementById('form-add-parceiro').onsubmit = function(e) {
  e.preventDefault();
  const parceiro = document.getElementById('add-parceiro-select').value;
  const data = document.getElementById('add-parceiro-data').value;
  const quantidade = parseFloat(document.getElementById('add-parceiro-quantidade').value);
  const preco = parseFloat(document.getElementById('add-parceiro-preco').value);
  const observacao = document.getElementById('add-parceiro-observacao').value || '';
  if (parceiro === 'Gelo') {
    const tipoRadio = document.querySelector('input[name="tipo-gelo-modal"]:checked');
    if (!tipoRadio) {
      alert('Selecione o tipo de gelo.');
      return;
    }
    registrosParceiros.Gelo.push({
      tipo: tipoRadio.value,
      data,
      quantidade,
      preco,
      observacao
    });
    salvarParceiros();
    renderRegistros('Gelo');
  } else {
    registrosParceiros[parceiro].push({
      data,
      quantidade,
      preco,
      observacao
    });
    salvarParceiros();
    renderRegistros(parceiro);
  }
  renderParceiroCards();
  document.getElementById('modal-add-parceiro').classList.add('hidden');
  document.getElementById('modal-add-parceiro').style.display = 'none';
  if (window.salaryTracker) window.salaryTracker.showFeedback('âœ… Registro adicionado com sucesso!', 'success');
};

window.renderRegistros = renderRegistros;
</script>
<style>
.section { display: none; }
.section.active { display: block; }
</style>
<script>
const parceirosList = [
  { nome: 'Diego', servico: 'Coco' },
  { nome: 'Daniel', servico: 'Pastel' },
  { nome: 'LuÃ­s', servico: 'Gelo' }
];
let parceiroSelecionado = 'Diego'; // PadrÃ£o

function getTotalParceiro(nome) {
  if (!window.registrosParceiros) return 0;
  let key = '';
  if (nome === 'Diego') key = 'Coco';
  if (nome === 'Daniel') key = 'Pastel';
  if (nome === 'LuÃ­s') key = 'Gelo';
  const regs = window.registrosParceiros && window.registrosParceiros[key] ? window.registrosParceiros[key] : [];
  return regs.reduce((soma, reg) => soma + (parseFloat(reg.quantidade) || 0) * (parseFloat(reg.preco) || 0), 0);
}

function renderParceiroCards() {
  const container = document.getElementById('parceiro-cards');
  if (!container) return;
  container.innerHTML = parceirosList.map(parc => {
    let key = '';
    if (parc.nome === 'Diego') key = 'Coco';
    if (parc.nome === 'Daniel') key = 'Pastel';
    if (parc.nome === 'LuÃ­s') key = 'Gelo';
    const regs = window.registrosParceiros && window.registrosParceiros[key] ? window.registrosParceiros[key] : [];
    const temRegistros = regs.length > 0;
    return `
      <div class="parceiro-card${parc.nome === parceiroSelecionado ? ' parceiro-card--active' : ''}">
        <div class="parceiro-card__nome">${'ğŸ¤ ' + parc.nome}</div>
        <div class="parceiro-card__servico">${parc.servico}</div>
        <div class="parceiro-card__valor">R$ ${getTotalParceiro(parc.nome).toLocaleString('pt-BR', {minimumFractionDigits:2})}</div>
        <button class="parceiro-card__pago" 
          onclick="marcarPagoParceiro('${parc.nome}')"
          ${!temRegistros ? 'disabled' : ''}>ğŸ’° Pago</button>
      </div>
    `;
  }).join('');
}
window.marcarPagoParceiro = function(nome) {
  let key = '';
  if (nome === 'Diego') key = 'Coco';
  if (nome === 'Daniel') key = 'Pastel';
  if (nome === 'LuÃ­s') key = 'Gelo';
  if (!window.registrosParceiros || !window.registrosParceiros[key] || window.registrosParceiros[key].length === 0) return;
  window._parceiroPagoKey = key;
  document.getElementById('modal-title').textContent = 'ğŸ’° Marcar como Pago';
  document.getElementById('modal-message').textContent = `Tem certeza que deseja marcar tudo como pago? Isso irÃ¡ apagar todos os registros de ${nome}.`;
  document.getElementById('confirmation-modal').classList.remove('hidden');
  document.getElementById('confirmation-modal').style.display = 'block';
};
// Inicializa ao carregar
document.addEventListener('DOMContentLoaded', function() {
  renderParceiroCards();
  renderVendasDia();
});
</script>
</body>
</html>
